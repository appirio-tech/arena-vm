{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Parameters":
    {
        "EC2AvZones":
        {
            "Description": "EC2 Availability zones (comma-delimited)",
            "Type": "CommaDelimitedList",
            "Default": "us-east-1d"
        },
        "BootScriptUrl":
        {
            "Description": "s3 URL to the EC2 boot script",
            "Type": "String",
            "Default": "s3://tc-deploy/boot/v1/tc-boot"
        },
        "BootEnvUrl":
        {
            "Description": "s3 URL to the boot env config file",
            "Type": "String",
            "Default": "s3://tc-deploy/arena/qa/processor/processor-boot-env"
        },
        "EnvironmentPrefix":
        {
            "Description": "A prefix to use for resources (e.g., dev, qa, prod)",
            "Type": "String",
            "Default": "qa"
        },
        "PoolMinSize":
        {
            "Description": "Minimum pool size",
            "Type": "Number",
            "Default": "0"
        },
        "PoolMaxSize":
        {
            "Description": "Maximum pool size",
            "Type": "Number",
            "Default": "3"
        },
        "JVMArgs":
        {
            "Description": "Additional JVM args",
            "Type": "String",
            "Default": "-Darena.processor-queues=compile -Darena.processor-default-timeout=1 -Darena.processor-max-messages=1 -Darena.processor-serial-processing=true -Dnetworkaddress.cache.ttl=60 -XX:-OmitStackTraceInFastThrow"
        },
        "VPCZoneId":
        {
        	"Description": "The VPC Zone IDs (comma-delimited list)",
        	"Type": "CommaDelimitedList",
        	"Default": "subnet-ac9483ea"
        },
        "ArenaProcessorLaunchConfig": {
        	"Description": "The launch configuration",
        	"Type": "String",
        	"Default": "Arena-Processor-QA-ProcessorLaunchConfig"
        },
        "ArenaProcessorRole": {
        	"Description": "IAM instance profile role",
        	"Type": "String",
        	"Default": "Arena-App-QA-ArenaAppRole-1JAJPXPZQY0NJ"
		}
    },
    "Resources":
    {
    	"ArenaProcessorAutoScalingGroup":
        {
            "Type": "AWS::AutoScaling::AutoScalingGroup",
            "Properties":
            {
                "AvailabilityZones":
                {
                    "Ref": "EC2AvZones"
                },
                "LaunchConfigurationName":
                {
                    "Ref": "ArenaProcessorLaunchConfig"
                },
                "MinSize":
                {
                    "Ref": "PoolMinSize"
                },
                "MaxSize":
                {
                    "Ref": "PoolMaxSize"
                },
                "VPCZoneIdentifier": {"Ref": "VPCZoneId"},
                "Cooldown": "10",
                "HealthCheckType": "EC2",
                "HealthCheckGracePeriod": "600",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value":
                        {
                            "Fn::Join": [" ", [
                            {
                                "Ref": "AWS::StackName"
                            }, "Auto-Scale Instance"]]
                        },
                        "PropagateAtLaunch": "true"
                    },
                    {
                        "Key": "appirio:boot:boot-script",
                        "Value":
                        {
                            "Ref": "BootScriptUrl"
                        },
                        "PropagateAtLaunch": "true"
                    },
                    {
                        "Key": "appirio:boot:java-iam-role",
                        "Value":
                        {
                            "Ref": "ArenaProcessorRole"
                        },
                        "PropagateAtLaunch": "true"
                    },
                    {
                        "Key": "appirio:boot:jvm-opts",
                        "Value":
                        {
                            "Ref": "JVMArgs"
                        },
                        "PropagateAtLaunch": "true"
                    },
                    {
                        "Key": "appirio:boot:boot-env",
                        "Value":
                        {
                            "Ref": "BootEnvUrl"
                        },
                        "PropagateAtLaunch": "true"
                    },
                    {
                        "Key": "appirio:boot:assign-elastic-ip",
                        "Value": "false",
                        "PropagateAtLaunch": "true"
                    },
                    {
                        "Key": "appirio:boot:env-prefix",
                        "Value":
                        {
                            "Ref": "EnvironmentPrefix"
                        },
                        "PropagateAtLaunch": "true"
                    }

                ]
            }
        }
    }
}